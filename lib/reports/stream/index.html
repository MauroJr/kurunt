<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Kurunt - Stream Report</title>

<script src="jquery.min.js"></script>
<script src="sly.min.js"></script>
<script src="plugins.js"></script>
<script src="smoothie.js"></script>

<meta name="viewport" content="user-scalable=yes" /> 

<style type="text/css">
html { height: 100%; margin-bottom: 0.00em; background: #535151; }

* { padding:0; margin:0; }
body {
	text-align: center;
	position: relative;
	font-family: arial,helvetica,sans-serif,"Lucida Grande","Lucida Sans Unicode";
	font-size: 10pt;
	background: #d6d7da;
}
p {
	font-size: 10pt;
	line-height: 1.2em;
	color: #1d272e;
	margin: 8px 0 8px 0;
}
a:link, a:visited { color:#258b86; }
a:hover { color:#000; }
img { border:0; }

.spaceout { padding-top: 11px; }
.nada { display: none; }
.wraper { 
	padding: 0 2.5em 0 2.5em; 
	margin: 0 auto; 
	width: 1060px; 
	text-align: left;
	overflow: auto;
}




.white { background: #fff; }

h1 {  
	margin-top: 1em;

	font-size: 26pt; 
	font-weight: bold;
	color: #000;
}

h2 {  
	margin-top: 10px;
	font-size: 20pt; 
	font-weight: bold;
	color: #000;
	padding-bottom: 8px;
}

/* Smoothie Chart */
#chart {
	margin-top: 3em;
	width: 1060px;
	height: 120px;
}


/* Messages Totals */ 
.rounded-corners {
	-moz-border-radius: 20px;
	-webkit-border-radius: 20px;
	-khtml-border-radius: 20px;
	border-radius: 20px;
}

#messages_totals {
	margin-top: 2.2em;
	clear: both;
}

#messages_total {
	padding-top: 2em;
	width: 400px;
	height: 90px;
	float: left;
	text-align: center;
	background: #333333;
	color: #fff;
}

#messages_total_int {
	font-size: 24pt; 
	font-weight: normal;
	color: #fff;
}
#messages_total h3 {
	padding-top: 7px;
	font-size: 12pt; 
	font-weight: normal;
	color: #A0A0A0;
	text-transform: uppercase;
}

#messages_ps {
	padding-top: 2em;
	width: 400px;
	height: 90px;
	float: right;
	text-align: center;
	background: #333333;
	color: #fff;
}

#messages_ps_int {
	padding-top: 10px;
	font-size: 24pt; 
	font-weight: normal;
	color: #fff;
}
#messages_ps h3 {
	padding-top: 7px;
	font-size: 12pt; 
	font-weight: normal;
	color: #A0A0A0;
	text-transform: uppercase;
}

/* messages tiles */
.pauseMe {
	float: right;
  background-image: url(pause.png);
	background-color: transparent;
	background-repeat: no-repeat;
	background-position: 0px 0px;
	border: none;
	cursor: pointer;
	height: 32px;
	padding-left: 32px;
	vertical-align: middle;
}   

.pagespan { clear: both; margin: 2em 0 4em 0; }

/* Example wrapper */
.wrap {
	position: relative;
	margin: 2em 0;
}

/* Frame */
.frame {
	height: 250px;
	overflow: hidden;
}
.frame ul {
	list-style: none;
	margin: 0;
	padding: 0;
	height: 100%;
}
.frame ul li {
	float: left;
	width: 227px;
	height: 100%;
	margin: 0 1px 0 0;
	padding: 0;
	background: #333;
	color: #ddd;
	cursor: pointer;
}
.frame ul li.active {
	color: #fff;
	background: #a03232;
}

/* Message */
.frame h3 {
	font-size: 24pt; 
	font-weight: normal;
	text-align: center;
	margin: .7em 0 0 .7em;
	color: #fff;
}

.message {
	margin: 1em 2em 2em 2em;
}

.message p {
	margin: 0 0 7px 0;
	padding: 0;
	color: #ddd;
	font-size: 12pt;	
}

.messagejson {
	height: 196px;
	background: #413F3F;
	overflow-y: scroll;
	border: 1px solid #4A4A4A;
}

pre { outline: 0px solid #ccc; padding: 5px; margin: 5px; color: #7F7F7F; }
.string { color: #0CC50C; }
.number { color: #EACE47; }
.boolean { color: #1979d3; }
.null { color: #C50CC0; }
.key { color: #fff; }


/* Scrollbar */
.scrollbar {
	margin: 2em 0 1em 0;
	height: 2px;
	background: #ccc;
	line-height: 0;
}
.scrollbar .handle {
	width: 100px;
	height: 100%;
	background: #292a33;
	cursor: pointer;
}
.scrollbar .handle .mousearea {
	position: absolute;
	top: -9px;
	left: 0;
	width: 100%;
	height: 20px;
}

/* One Item Per Frame example*/
.oneperframe { 
	height: 300px;
}
.oneperframe ul li { width: 1060px; }
.oneperframe ul li.active { background: #333; }

/* Effects */
.effects {
	height: 200px;
	line-height: 200px;
	-webkit-perspective: 800px;
	-ms-perspective: 800px;
	perspective: 800px;
	-webkit-perspective-origin: 50% 50%;
	-ms-perspective-origin: 50% 50%;
	perspective-origin: 50% 50%;
	overflow-y: show;
}
.effects ul {
	-webkit-transform-style: preserve-3d;
	-ms-transform-style: preserve-3d;
	transform-style: preserve-3d;
}
.effects ul li {
	position: relative;
	margin: 0 -20px;
	-webkit-transform: rotateY(60deg) scale(0.9);
	-ms-transform: rotateY(60deg) scale(0.9);
	transform: rotateY(60deg) scale(0.9);
	-webkit-transition: -webkit-transform 300ms ease-out;
	transition: transform 300ms ease-out;
}
.effects ul li.active {
	z-index: 10;
	-webkit-transform: scale(1);
	-ms-transform: scale(1);
	transform: scale(1);
}
.effects ul li.active ~ li {
	-webkit-transform: rotateY(-60deg) scale(0.9);
	-ms-transform: rotateY(-60deg) scale(0.9);
	transform: rotateY(-60deg) scale(0.9);
}


/* top toolbar */
header {
	
width: 100%;
float: left;
position: relative;
}


#headermenu{
	height: 66px;
	margin: 0;
	width: 100%;
		background: #F25446;
	border-bottom: 1px solid #fff;

}

#logo {
	margin: 18px 0 0 0;
	padding: 0;
	text-align: left;
	float: left;
}

#navs {
	margin-top: 21px;
	float: left;
	text-align: right;
}

#navs a {
	font-size: 17pt; 
	font-weight: normal;
	color: #fff;
	text-transform: uppercase;
	text-decoration: none;
	margin-left: 4em;
}

#navs a:hover { color: #c1c8c8; }
.nav_seperator { margin: 0 6px 0 6px; color: #fff; }

/* footer */


#footer {
	padding-top: 3px;
	background: #535151;
	border-top: 1px solid #c1c8c8;

}

#footer p{ text-align: left; font-size: 10pt; color: #c1c8c8; clear: both; padding-top: 3px; border-bottom: 0px solid #c1c8c8;}
#footer a { color: #c1c8c8; text-decoration: none; }
#footer a:hover { color: #fff; }

#footer .copyright a { text-decoration: underline; }

.seperator { margin: 0 5px 0 5px; color: #c1c8c8; }

/* select_data pulldown menu */
#select_data {
	margin-top: 2.7em;
	padding: 8px;
	float: right;
	background: #D6D7DA;
}

#select_data h5 {
	font-size: 11pt; 
	padding: 3px;
	font-weight: normal;
	color: #000;
	display: inline;
}

#select_data select {
		min-width: 250px;
}

</style>

</head>
<body onload="createSmoothieChart()">

<header role="banner">
<div id="headermenu">
	<div class="wraper">
			
		<div id="logo"><img src="logo.png" alt="" /></div>
				
		<div id="navs">
		
			<a href="data.html">Data</a>
			<a href="stream.html">Stream</a>		
					
		</div>	
				
	</div>
</div>
</header>


<div class="wraper white">

<div id="select_data">
	<h5>Data:</h5>
	<select>
		<option>test_5a5f55a555aa5555</option>
		<option>jpeg_2a5f55a555aa2222</option>
		<option>benchmark_1a5f55a555aa1234</option>
	</select>
	
</div>

<h1>Stream Report</h1>

<script src="/socket.io/socket.io.js"></script>
<script>

	var smoothieChart = new TimeSeries();
	var msgps = 0;

  var socket = io.connect('http://192.168.1.22');  // localhost, set ip for remote access.

	var num_from = 0;
	function update_events_number(divid, num_to) {
		if ( num_to == num_from || num_from === 0 ) { 
			$(divid).text( int_commas(num_to) + ' ');
			num_from = num_to;
			return;
		}
		var tick = (num_to - num_from) / 10;
		var moving_total = num_from;
		moving_total = Math.round(moving_total + tick); $(divid).text( int_commas(moving_total) + ' ');
		setTimeout(function() { moving_total = Math.round(moving_total + tick); $(divid).text( int_commas(moving_total) + ' '); }, 100);
		setTimeout(function() { moving_total = Math.round(moving_total + tick); $(divid).text( int_commas(moving_total) + ' '); }, 200);
		setTimeout(function() { moving_total = Math.round(moving_total + tick); $(divid).text( int_commas(moving_total) + ' '); }, 300);
		setTimeout(function() { moving_total = Math.round(moving_total + tick); $(divid).text( int_commas(moving_total) + ' '); }, 400);
		setTimeout(function() { moving_total = Math.round(moving_total + tick); $(divid).text( int_commas(moving_total) + ' '); }, 500);
		setTimeout(function() { moving_total = Math.round(moving_total + tick); $(divid).text( int_commas(moving_total) + ' '); }, 600);
		setTimeout(function() { moving_total = Math.round(moving_total + tick); $(divid).text( int_commas(moving_total) + ' '); }, 700);
		setTimeout(function() { moving_total = Math.round(moving_total + tick); $(divid).text( int_commas(moving_total) + ' '); }, 800);
		setTimeout(function() { moving_total = Math.round(moving_total + tick); $(divid).text( int_commas(moving_total) + ' '); }, 900);
		num_from = num_to;
	}

	function int_commas(x) {
		// note with jade must escape regex eg: /\B become /\\B etc. 
		return format_num = x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
	}

  socket.on('ticker', function (tot, mps) {
    update_events_number('#messages_total_int', tot);
		$('#messages_ps_int').text(int_commas(mps));
  	msgps = mps;
  });
  
	socket.on('messages', function (messages) {
		i = 0; // reset
		for ( var m in messages ) {
			if ( ids[messages[m].id] === undefined ) {
				ids[messages[m].id] = 1;
				addItem(messages[m], i);
			}
			i++;
		}
	});
	
	var addItem = undefined;
	var QUE_MESSAGES_SLY_X = 10;

	var ids = {};
	var firstItem = true;

	var x = 0;

	jQuery(function($){

		(function () {
			var $frame = $('#oneperframe');
			var $wrap  = $frame.parent();
			var $slidee = $frame.children('ul').eq(0);

			// Call Sly on frame
			$frame.sly({
				horizontal: 1,
				itemNav: 'forceCentered',
				smart: 1,
				activateMiddle: 1,
				mouseDragging: 1,
				touchDragging: 1,
				releaseSwing: 1,
				startAt: 0,
				scrollBar: $wrap.find('.scrollbar'),
				scrollBy: 1,
				speed: 300,
				elasticBounds: 1,
				easing: 'easeOutExpo',
				dragHandle: 1,
				dynamicHandle: 1,
				clickBar: 1
			});

		// Pause button
		var paused = false;
		var i = 0;

		addItem = function(m, i) {
	
			if ( paused === true ) {
				return;
			}
	
			if ( firstItem === true ) {
				$frame.sly('remove', 0);
				firstItem = false;
			}

			if ( x >= QUE_MESSAGES_SLY_X ) {
				$('#m' + i).replaceWith('<li id="m' + i + '"><h3>' + m.id + '</h3><div class="message"><div class="messagejson"><pre><code>' + jsonHighlight(JSON.stringify(m, undefined, 4)) + '</code></pre></div></div></li>');
			} else {
				$frame.sly('add', '<li id="m' + i + '"><h3>' + m.id + '</h3><div class="message"><div class="messagejson"><pre><code>' + jsonHighlight(JSON.stringify(m, undefined, 4)) + '</code></pre></div></div></li>');		
			}
	
			$frame.sly('toEnd');
	
			x++;
		};			

		var $wrapr  = jQuery('#oneperframe').parent();
		$wrapr.find('.pauseMe').on('click', function () {
			if ( paused === true ) {
				$(this).css('background-image', 'url(pause.png)');
				paused = false;
			}	else {
				$(this).css('background-image', 'url(play.png)');
				paused = true;
				i = x;
			}
		});

		}());
	});

	// convert js object into colour highlighted html.
	function jsonHighlight(json) {
		json = json.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
		return json.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g, function (match) {
			var cls = 'number';
			if (/^"/.test(match)) {
				if (/:$/.test(match)) {
					cls = 'key';
				} else {
					cls = 'string';
				}
			} else if (/true|false/.test(match)) {
				cls = 'boolean';
			} else if (/null/.test(match)) {
				cls = 'null';
			}
				return '<span class="' + cls + '">' + match + '</span>';
		});
	}

	setInterval(function() {
		smoothieChart.append(new Date().getTime(), msgps);
	}, 500);
     
	function createSmoothieChart() {
		var chart = new SmoothieChart({grid:{fillStyle:'#333333'},labels:{precision:0}});
		chart.addTimeSeries(smoothieChart, { strokeStyle: 'rgba(0, 255, 0, 1)', fillStyle: 'rgba(0, 255, 0, 0.2)', lineWidth: 2 });
		chart.streamTo(document.getElementById("chart"), 500);
	}

</script>


<div id="messages_totals">
	<div id="messages_total" class="rounded-corners"><span id="messages_total_int"></span><h3>Messages</h3></div>
	<div id="messages_ps" class="rounded-corners"><span id="messages_ps_int"></span><h3>Messages Per Second</h3></div>
</div>

<canvas id="chart" width="1060" height="120"></canvas>

<div class="pagespan container">
	<div class="wrap">
		
			<div class="btn">
				<button class="pauseMe"></button>
			</div>			

			<br/>
			
			<div class="scrollbar">
				<div class="handle">
					<div class="mousearea"></div>
				</div>
			</div>

			<div class="frame oneperframe" id="oneperframe">
				<ul class="clearfix">
					<li></li>
				</ul>
			</div>

		</div>
</div>


</div>


	<div id="footer">
			<div class="wraper">
				<p> 
					<a href="http://kurunt.com">Kurunt</a>
					<span class="seperator"> |</span>
					<a href="http://kurunt.com/support/">Support</a>
					<span class="seperator"> |</span>	
					<a href="https://github.com/kurunt">GitHub</a>
					<span class="seperator"> |</span>
					<a href="http://kurunt.com/license/">License</a>
				</p>	
				<p class="copyright">
					&copy; Copyright Kurunt 2013. Except where otherwise <a href="http://kurunt.com/license/">noted</a>, content on this site is licensed under a <a href="http://creativecommons.org/licenses/by/3.0/">Creative Commons Attribution 3.0 License</a>.
				</p>

			</div>
		</div>		

</body>
</html>
